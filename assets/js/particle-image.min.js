"use strict";function ParticleImageDisplayer(t,e){this.pImageConfig={particles:{array:[],density:100,color:"#fff",size:{value:2,random:!1},movement:{speed:1,restless:{enabled:!1,value:10}},interactivity:{on_hover:{enabled:!0,action:"repulse"},on_click:{enabled:!1,action:"big_repulse"},on_touch:{enabled:!0,action:"repulse"},fn_array:[]}},image:{src:{path:null,is_external:!1},size:{canvas_pct:60,min_px:50,max_px:800},bottom_constraint:{el:document.getElementById("header-content")}},interactions:{repulse:{distance:100,strength:200},big_repulse:{distance:100,strength:500},grab:{distance:100,line_width:1}},canvas:{el:t,w:t.offsetWidth,h:t.offsetHeight,offset_top:72},animation:{lastTimestamp:0,targetFPS:60,deltaTime:0},functions:{particles:{},image:{},canvas:{},interactivity:{},utils:{}},mouse:{x:null,y:null,click_x:null,click_y:null}};const n=this.pImageConfig;e&&Object.deepExtend(n,e),n.functions.canvas.init=function(){n.canvas.context=n.canvas.el.getContext("2d"),n.canvas.el.width=n.canvas.w,n.canvas.el.height=n.canvas.h,n.image.height_available=n.image.bottom_constraint.el.offsetTop-n.canvas.offset_top,n.canvas.aspect_ratio=n.canvas.w/n.image.height_available,window.addEventListener("resize",n.functions.utils.debounce(n.functions.canvas.onResize,200),n.eventListenerOpts)},n.functions.canvas.onResize=function(){n.canvas.w=n.canvas.el.offsetWidth,n.canvas.h=n.canvas.el.offsetHeight,n.canvas.el.width=n.canvas.w,n.canvas.el.height=n.canvas.h,n.image.height_available=n.image.bottom_constraint.el.offsetTop-n.canvas.offset_top,n.canvas.aspect_ratio=n.canvas.w/n.image.height_available,n.particles.array=[],n.functions.image.resize();const t=n.functions.canvas.getImagePixels();n.functions.particles.createImageParticles(t,!0)},n.functions.canvas.clear=function(){n.canvas.context.clearRect(0,0,n.canvas.w,n.canvas.h)},n.functions.canvas.getImagePixels=function(){n.functions.canvas.clear(),n.canvas.context.drawImage(n.image.obj,n.image.x,n.image.y,n.image.obj.width,n.image.obj.height);const t=n.canvas.context.getImageData(n.image.x,n.image.y,n.image.obj.width,n.image.obj.height);return n.functions.canvas.clear(),t},n.functions.image.resize=function(){n.image.aspect_ratio<n.canvas.aspect_ratio?(n.image.obj.height=n.functions.utils.clamp(Math.round(n.image.height_available*n.image.size.canvas_pct/100),n.image.size.min_px,n.image.size.max_px),n.image.obj.width=Math.round(n.image.obj.height*n.image.aspect_ratio)):(n.image.obj.width=n.functions.utils.clamp(Math.round(n.canvas.w*n.image.size.canvas_pct/100),n.image.size.min_px,n.image.size.max_px),n.image.obj.height=Math.round(n.image.obj.width/n.image.aspect_ratio)),n.image.x=n.canvas.w/2-n.image.obj.width/2,n.image.y=n.image.height_available/2-n.image.obj.height/2},n.functions.image.init=function(){n.image.obj=new Image,n.image.obj.addEventListener("load",(()=>{n.image.aspect_ratio=n.image.obj.width/n.image.obj.height,n.functions.image.resize();const t=n.functions.canvas.getImagePixels();n.functions.particles.createImageParticles(t),window.requestAnimationFrame(n.functions.particles.animateParticles)}),n.eventListenerOpts);let t=n.image.src.path;n.image.src.is_external&&(t=`https://cors-anywhere.herokuapp.com/${n.image.src.path}`,n.image.obj.crossOrigin="anonymous"),n.image.obj.src=t},n.functions.particles.SingleImageParticle=function(t,e){this.x=t.x,this.y=t.y,this.dest_x=e.x,this.dest_y=e.y,this.vx=(Math.random()-.5)*n.particles.movement.speed,this.vy=(Math.random()-.5)*n.particles.movement.speed,this.acc_x=0,this.acc_y=0,this.friction=.01*Math.random()+.92,this.restlessness={max_displacement:Math.ceil(Math.random()*n.particles.movement.restless.value),x_jitter:n.functions.utils.randIntInRange(-3,3),y_jitter:n.functions.utils.randIntInRange(-3,3),on_curr_frame:!1},n.particles.color instanceof Array?this.color=n.particles.color[Math.floor(Math.random()*(n.particles.color.length+1))]:this.color=n.particles.color,this.radius=Math.round((n.particles.size.random?Math.max(Math.random(),.5):1)*n.particles.size.value)},n.functions.particles.SingleImageParticle.prototype.draw=function(){n.canvas.context.fillStyle=this.color,n.canvas.context.beginPath(),n.canvas.context.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),n.canvas.context.fill()},n.functions.particles.createImageParticles=function(t,e=!1){const a=Math.round(t.width/n.particles.density);for(let i=0;i<t.width;i+=a)for(let s=0;s<t.height;s+=a)if(t.data[4*(i+s*t.width)+3]>128){const t={x:n.image.x+i,y:n.image.y+s},a=e?t:{x:Math.random()*n.canvas.w,y:Math.random()*n.canvas.h};n.particles.array.push(new n.functions.particles.SingleImageParticle(a,t))}},n.functions.particles.updateParticles=function(t){const e=t||1;for(const t of n.particles.array)n.particles.movement.restless.enabled&&t.restlessness.on_curr_frame?n.functions.particles.jitterParticle(t,e):(t.acc_x=(t.dest_x-t.x)/500,t.acc_y=(t.dest_y-t.y)/500,t.vx=(t.vx+t.acc_x)*t.friction,t.vy=(t.vy+t.acc_y)*t.friction,t.x+=t.vx*e,t.y+=t.vy*e),n.functions.interactivity.interactWithClient(t,e)},n.functions.particles.jitterParticle=function(t,e){const a=e||1;t.x+=t.restlessness.x_jitter*a,t.y+=t.restlessness.y_jitter*a,Math.sqrt((t.dest_x-t.x)**2+(t.dest_y-t.y)**2)>=n.particles.movement.restless.value&&(t.restlessness.on_curr_frame=!1)},n.functions.particles.animateParticles=function(t){0===n.animation.lastTimestamp&&(n.animation.lastTimestamp=t);const e=t-n.animation.lastTimestamp;n.animation.lastTimestamp=t;const a=1e3/n.animation.targetFPS,i=Math.min(e/a,2);n.functions.canvas.clear(),n.functions.particles.updateParticles(i);for(const t of n.particles.array)t.draw();window.requestAnimationFrame(n.functions.particles.animateParticles)},n.functions.interactivity.repulseParticle=function(t,e,a=1){const i=t.x-n.mouse.x,s=t.y-n.mouse.y,c=Math.sqrt(i*i+s*s),o=n.functions.utils.clamp(300-e.strength,10,300);c<=e.distance&&(t.acc_x=(t.x-n.mouse.x)/o,t.acc_y=(t.y-n.mouse.y)/o,t.vx+=t.acc_x*a,t.vy+=t.acc_y*a)},n.functions.interactivity.grabParticle=function(t,e){const a=t.x-n.mouse.x,i=t.y-n.mouse.y;Math.sqrt(a*a+i*i)<=e.distance&&(n.canvas.context.strokeStyle=t.color,n.canvas.context.lineWidth=Math.min(e.line_width,2*t.radius),n.canvas.context.beginPath(),n.canvas.context.moveTo(t.x,t.y),n.canvas.context.lineTo(n.mouse.x,n.mouse.y),n.canvas.context.stroke(),n.canvas.context.closePath())},n.functions.interactivity.onMouseMove=function(t,e,a,i){null!=n.mouse.x&&null!=n.mouse.y&&t(a,e,i)},n.functions.interactivity.onMouseClick=function(t,e,a,i){null!=n.mouse.click_x&&null!=n.mouse.click_y&&t(a,e,i)},n.functions.interactivity.addEventListeners=function(){(n.particles.interactivity.on_hover.enabled||n.particles.interactivity.on_click.enabled)&&(n.canvas.el.addEventListener("mousemove",(t=>{const e=t.offsetX||t.clientX,a=t.offsetY||t.clientY;n.mouse.x=e,n.mouse.y=a}),n.eventListenerOpts),n.canvas.el.addEventListener("mouseleave",(()=>{n.mouse.x=null,n.mouse.y=null}),n.eventListenerOpts),n.functions.utils.addEventActions("on_hover")),n.particles.interactivity.on_click.enabled&&(n.canvas.el.addEventListener("mousedown",(()=>{n.mouse.click_x=n.mouse.x,n.mouse.click_y=n.mouse.y}),n.eventListenerOpts),n.canvas.el.addEventListener("mouseup",(()=>{n.mouse.click_x=null,n.mouse.click_y=null}),n.eventListenerOpts),n.functions.utils.addEventActions("on_click")),n.particles.interactivity.on_touch.enabled&&(n.canvas.el.addEventListener("touchmove",(t=>{const e=t.touches[0].clientX,a=t.touches[0].clientY;n.mouse.x=e,n.mouse.y=a}),n.eventListenerOpts),n.canvas.el.addEventListener("touchend",(()=>{n.mouse.x=null,n.mouse.y=null}),n.eventListenerOpts),n.functions.utils.addEventActions("on_touch"))},n.functions.interactivity.interactWithClient=function(t,e){for(const a of n.particles.interactivity.fn_array)a(t,e)},n.functions.utils.randIntInRange=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},n.functions.utils.clamp=function(t,e,n){return Math.min(Math.max(t,e),n)},n.functions.utils.debounce=function(t,e){let n;return a=>{n&&clearTimeout(n),n=setTimeout(t,e,a)}},n.functions.utils.addEventActions=function(t){const e={repulse:n.functions.interactivity.repulseParticle,big_repulse:n.functions.interactivity.repulseParticle,grab:n.functions.interactivity.grabParticle},a="on_click"===t?n.functions.interactivity.onMouseClick:n.functions.interactivity.onMouseMove;if(n.particles.interactivity[t].enabled){const i=e[n.particles.interactivity[t].action],s=n.interactions[n.particles.interactivity[t].action],c=(t,e)=>a(i,s,t,e);n.particles.interactivity.fn_array.push(c)}},n.functions.launch=function(){n.functions.interactivity.addEventListeners(),n.functions.canvas.init(),n.functions.image.init()},n.disabled||n.functions.launch()}Object.deepExtend=function t(e,n){for(const a in n)n[a]&&n[a].constructor&&n[a].constructor===Object?(e[a]=e[a]||{},t(e[a],n[a])):e[a]=n[a];return e},window.pImgDom=[],window.particleImageDisplay=function(t){let e=!1;try{const t=Object.defineProperty({},"passive",{get:()=>{e={passive:!0}}});window.addEventListener("checkPEL",null,t),window.removeEventListener("checkPEL",null,t)}catch{}const n=document.getElementById(t),a="particle-image-canvas-el",i=n.getElementsByClassName(a);if(i.length)for(;i.length>0;)n.removeChild(i[0]);const s=document.createElement("canvas");s.className=a,s.style.width="100%",s.style.height="calc(100% - 72px)";const c=document.getElementById(t).appendChild(s);if(null!=c){const t=n.dataset.paramsSrc;fetch(t).then((t=>{if(!t.ok)throw new Error(t.statusText);return t.json()})).then((t=>{t.eventListenerOpts=e,window.pImgDom.push(new ParticleImageDisplayer(c,t))})).catch((t=>{console.log(`failed to load params.json: ${t.message}`)}))}},window.particleImageDisplay("particle-image");
//# sourceMappingURL=particle-image.min.js.map