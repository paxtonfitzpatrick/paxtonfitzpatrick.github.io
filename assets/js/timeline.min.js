(()=>{"use strict";class t{constructor(t,e){this.timeline=e,this.info=t.innerText.trim(),this.startYear=parseFloat(t.dataset.start),this.endYear=parseFloat(t.dataset.end),this.color=`#${t.dataset.color}`,this.xCoord=null}drawEventLine(){const t=this.timeline.canvas.context,e=this.timeline.style.eventWidth,i=this.timeline.yearsYCoords;t.beginPath(),t.lineWidth=e,t.strokeStyle=this.color,t.lineCap="round",t.moveTo(this.xCoord,i[this.startYear]+e/2),t.lineTo(this.xCoord,i[this.endYear]-e/2),t.stroke()}drawInfo(t){const e=this.timeline.canvas.context;e.beginPath(),e.strokeStyle=this.color,e.lineWidth=this.timeline.style.infoLineWidth,e.fillStyle=this.timeline.style.infoFontColor,e.textBaseline="bottom",e.textAlign=t.alignment,e.lineJoin="round",t.lineArr.forEach(((i,n,s)=>{e.fillText(i,t.xCoord,t.underlineY-this.timeline.style.infoUnderlineOffset-this.timeline.style.infoLineHeight*(s.length-1-n))}));let i=this.timeline.yearsYCoords[this.startYear+this.timeline.style.infoYOffset];this.endYear-this.startYear<=this.timeline.style.infoYOffset&&(i=Math.floor((this.timeline.yearsYCoords[this.startYear]+this.timeline.yearsYCoords[this.endYear])/2)),e.moveTo(this.xCoord,i),e.lineTo(t.xCoord,t.underlineY),e.lineTo(t.underlineX,t.underlineY),e.stroke()}computeInfoLayout(){const t={lineArr:[],underlineY:this.timeline.yearsYCoords[this.startYear]},e=this.info.split(" "),i=[];let n,s=e[0],r=this.timeline.canvas.context.measureText(e[0]).width;return this.xCoord>=this.timeline.centerXCoord?(t.xCoord=this.timeline.infoRightXCoord,t.alignment="left",n=this.timeline.currentWidth-t.xCoord-this.timeline.yearXOffset):(t.xCoord=this.timeline.infoLeftXCoord,t.alignment="right",n=t.xCoord),e.slice(1).forEach((e=>{const o=`${s} ${e}`,a=this.timeline.canvas.context.measureText(o).width;a>n||s.endsWith(",")?(t.lineArr.push(s),i.push(r),s=e,r=a-r):(s=o,r=a)})),t.lineArr.push(s),i.push(r),t.width=Math.max(...i),"left"===t.alignment?t.underlineX=t.xCoord+t.width:t.underlineX=t.xCoord-t.width,t}}class e{constructor(t){this.timelineElement=t,this.currentWidth=t.clientWidth,this.currentHeight=t.clientHeight,this.startYear=parseInt(t.dataset.start,10),this.endYear=parseInt(t.dataset.end,10),this.initCanvas(t),this.getStyles(),this.parseEvents(),this.precomputeStaticValues(),this.computeBaseLayout(),this.computeEventLayout(),this.drawBase(),this.drawEvents()}precomputeStaticValues(){const t=this.canvas.context;t.font=`${this.style.yearFontSize}px sans-serif`,t.textBaseline="bottom",this.yearXOffset=t.measureText("00000").width}adjustEventInfo(t){[this.infoLeftXCoord,this.infoRightXCoord].forEach((e=>{const i=t.filter((t=>t.xCoord===e));i.slice(1).forEach(((t,e)=>{const n=t.underlineY-this.style.infoUnderlineOffset-this.style.infoLineHeight*t.lineArr.length,s=i[e];if(n<s.underlineY+this.style.infoMinPaddingY){const r=s.underlineY+this.style.infoMinPaddingY-n,o=s.underlineY-this.style.infoUnderlineOffset-this.style.infoLineHeight*s.lineArr.length;0===e&&o-r>=0||e>0&&o-r>=i[e-1].underlineY+this.style.infoMinPaddingY?s.underlineY-=r:t.underlineY+=r}}))}))}computeBaseLayout(){const t=this.style.verticalPadding,e=(this.currentHeight-this.style.verticalPadding-t)/(4*(this.endYear-this.startYear)),i={},n={};for(let s=this.startYear,r=t;s<=this.endYear;s+=.25,r+=e)i[s]=Math.floor(r),n[s]=Array(this.events.length).fill(0);this.yearsYCoords=i,this.occupedGrid=n,this.centerXCoord=Math.round((this.currentWidth-this.yearXOffset)/2)}computeEventLayout(){const t=[this.centerXCoord];let e=1;for(;t.length<this.events.length;){const i=e*(this.style.eventWidth+this.style.eventOffset);t.push(this.centerXCoord+i),t.length<this.events.length&&t.push(this.centerXCoord-i),e++}const i=[];this.events.forEach((e=>{const n=this.occupedGrid[e.startYear].indexOf(0),s=t[n];e.xCoord=s,i.push(s);for(let t=e.startYear;t<e.endYear;t+=.25)this.occupedGrid[t][n]=1})),this.infoLeftXCoord=Math.min(...i)-this.style.infoXOffset,this.infoRightXCoord=Math.max(...i)+this.style.infoXOffset}drawBase(){const t=this.canvas.context;t.beginPath(),t.fillStyle=this.style.yearColor,t.textAlign="right",t.font=`${this.style.yearFontSize}px sans-serif`,t.strokeStyle=this.style.gridlineColor,t.lineWidth=this.style.gridlineWidth,Object.entries(this.yearsYCoords).forEach((([e,i])=>{Number.isInteger(Number(e))&&(t.fillText(e,this.currentWidth,i+this.style.yearFontSize/2),t.moveTo(0,i),t.lineTo(this.currentWidth-this.yearXOffset,i))})),t.stroke()}drawEvents(){const t=[];this.canvas.context.font=`${this.style.infoFontSize}px sans-serif`,this.events.forEach((e=>{e.drawEventLine(),t.push(e.computeInfoLayout())})),this.adjustEventInfo(t),this.events.forEach(((e,i)=>{e.drawInfo(t[i])}))}getStyles(){const t=getComputedStyle(this.timelineElement),e=t.getPropertyValue("--background-color").trim(),n=parseFloat(t.getPropertyValue("--background-alpha")),s=t.getPropertyValue("--year-color").trim(),r=parseFloat(t.getPropertyValue("--year-alpha")),o=t.getPropertyValue("--gridline-color").trim(),a=parseFloat(t.getPropertyValue("--gridline-alpha")),l=t.getPropertyValue("--info-font-color").trim(),h=parseInt(t.getPropertyValue("--info-font-alpha"),10),d=parseInt(t.getPropertyValue("--info-font-size"),10);this.style={verticalPadding:parseInt(t.getPropertyValue("--vertical-padding"),10),yearFontSize:parseInt(t.getPropertyValue("--year-font-size"),10),gridlineWidth:parseInt(t.getPropertyValue("--gridline-width"),10),eventWidth:parseInt(t.getPropertyValue("--event-width"),10),eventOffset:parseInt(t.getPropertyValue("--event-offset"),10),infoLineWidth:parseInt(t.getPropertyValue("--info-line-width"),10),infoUnderlineOffset:parseInt(t.getPropertyValue("--info-underline-offset"),10),infoXOffset:parseInt(t.getPropertyValue("--info-x-offset"),10),infoYOffset:parseFloat(t.getPropertyValue("--info-y-offset")),infoMinPaddingY:parseInt(t.getPropertyValue("--info-min-padding-y"),10),infoFontSize:d,infoLineHeight:Math.round(d*parseFloat(t.getPropertyValue("--info-line-height"))),backgroundColor:i(e,n),yearColor:i(s,r),gridlineColor:i(o,a),infoFontColor:i(l,h)}}initCanvas(t){const e=document.createElement("canvas");e.className="timeline-canvas-el",e.width=t.clientWidth,e.height=t.clientHeight,t.appendChild(e),this.canvas={element:e,context:e.getContext("2d")}}onResize(){const t=this.timelineElement.clientWidth,e=this.timelineElement.clientHeight;t===this.currentWidth&&e===this.currentHeight||(this.canvas.context.clearRect(0,0,this.currentWidth,this.currentHeight),this.canvas.element.width=t,this.canvas.element.height=e,this.currentWidth=t,this.currentHeight=e,this.computeBaseLayout(),this.computeEventLayout(),this.drawBase(),this.drawEvents())}parseEvents(){const e=this.timelineElement.getElementsByTagName("li"),i=[];Array.prototype.forEach.call(e,(e=>{i.push(new t(e,this))})),this.events=i}}const i=(t,e=1)=>{const i=t.replace("#","");return`rgba(${parseInt(i.substring(0,2),16)},${parseInt(i.substring(2,4),16)},${parseInt(i.substring(4,6),16)},${e})`},n=document.getElementById("timeline");null!==n&&window.addEventListener("load",(()=>{const t=new e(n);window.addEventListener("resize",(()=>t.onResize()))}))})();