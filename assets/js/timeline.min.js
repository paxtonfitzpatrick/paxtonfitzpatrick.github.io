"use strict";(()=>{class t{constructor(t,e){this.timeline=e,this.startYear=parseFloat(t.dataset.start);const i=t.dataset.end;this.endYear="present"===i?i:parseFloat(i),this.group=t.dataset.group,this.color=this.getColorFromGroup(),this.backgroundColor=o(this.color,e.style.infoBackgroundAlpha),this.info=t.innerText.trim(),this.xCoord=null}getColorFromGroup(){return getComputedStyle(this.timeline.timelineElement).getPropertyValue(`--group-${this.group}`).trim()||"#000000"}computeInfoLayout(){const{canvas:{context:t},style:e,yearsYCoords:i}=this.timeline,o={lineArr:[],bottomY:i[this.startYear]},n=this.info.split(" "),s=[];let r,a=n[0],h=t.measureText(n[0]).width;return this.xCoord>=this.timeline.centerXCoord?(o.lineXDest=this.timeline.infoRightXCoord,r=this.timeline.currentWidth-o.lineXDest-this.timeline.yearXOffset):(o.lineXDest=this.timeline.infoLeftXCoord,r=o.lineXDest),r-=2*e.infoBackgroundPadding,n.slice(1).forEach((e=>{const i=`${a} ${e}`,n=t.measureText(i).width;n>r||a.endsWith(",")?(o.lineArr.push(a),s.push(h),a=e,h=n-h):(a=i,h=n)})),o.lineArr.push(a),s.push(h),o.width=Math.max(...s)+2*e.infoBackgroundPadding,o.height=e.infoLineHeight*o.lineArr.length+2*e.infoBackgroundPadding,o}drawEventLine(){const{canvas:{context:t},style:{eventWidth:e},yearsYCoords:i}=this.timeline;if(t.beginPath(),t.lineWidth=e,t.lineCap="round",t.moveTo(this.xCoord,i[this.startYear]+e/2),"present"===this.endYear){const e=t.createLinearGradient(this.xCoord,i[this.startYear],this.xCoord,this.timeline.currentHeight);e.addColorStop(.25,this.color),e.addColorStop(1,this.timeline.style.backgroundColor),t.strokeStyle=e,t.lineTo(this.xCoord,this.timeline.currentHeight)}else t.strokeStyle=this.color,t.lineTo(this.xCoord,i[this.endYear]-e/2);t.stroke()}drawInfo(t){const{canvas:{context:e},style:i,yearsYCoords:s,centerXCoord:r}=this.timeline;let{lineXDest:a,bottomY:h}=t,l=a,d=s[this.startYear+i.infoYOffset];this.xCoord>=r?a+=i.infoBackgroundRadius/2:(a-=i.infoBackgroundRadius/2,l-=t.width),"present"!==this.endYear&&this.endYear-this.startYear<=i.infoYOffset&&(d=Math.round((this.timeline.yearsYCoords[this.startYear]+this.timeline.yearsYCoords[this.endYear])/2)),t.bottomY<d?h-=i.infoBackgroundRadius/2:t.bottomY-t.height>d?h-=t.height-i.infoBackgroundRadius/2:h-=t.height/2,e.strokeStyle=o(this.color,i.infoLineAlpha),e.lineWidth=i.infoLineWidth,e.beginPath(),e.moveTo(this.xCoord,d),e.lineTo(Math.round(a),Math.round(h)),e.stroke(),e.fillStyle=i.backgroundColor,n(e,l,t.bottomY-t.height,t.width,t.height,i.infoBackgroundRadius),e.fillStyle=this.backgroundColor,n(e,l,t.bottomY-t.height,t.width,t.height,i.infoBackgroundRadius),e.beginPath(),e.font=`${i.infoFontSize}px sans-serif`,e.fillStyle=i.infoFontColor,e.textBaseline="bottom",e.textAlign="left",e.lineJoin="round",t.lineArr.forEach(((o,n,s)=>{e.fillText(o,l+i.infoBackgroundPadding,t.bottomY-i.infoBackgroundPadding-i.infoLineHeight*(s.length-1-n)),o.endsWith(",")&&(e.font=`italic ${i.infoFontSize}px sans-serif`)}))}}class e{constructor(t){this.timelineElement=t,this.startYear=parseInt(t.dataset.start,10),this.endYear=parseInt(t.dataset.end,10),this.currentHoveredGroup=null,this.isHovering=!1,this.initCanvas(),this.getStyles(),this.parseEvents(),this.precomputeStaticValues(),this.computeBaseLayout(),this.computeEventLayout(),this.drawBase(),this.drawEvents(),this.setupHoverInteractions()}adjustEventInfo(t){[this.infoLeftXCoord,this.infoRightXCoord].forEach((e=>{const i=t.filter((t=>t.lineXDest===e));i.slice(1).forEach(((t,e)=>{const o=t.bottomY-t.height,n=i[e];if(o<n.bottomY+this.style.infoMinPaddingY){const s=n.bottomY+this.style.infoMinPaddingY-o;let r=n.bottomY-n.height;e>0&&(r-=i[e-1].bottomY+this.style.infoMinPaddingY),r>=s?n.bottomY-=s:(n.bottomY-=r,t.bottomY+=s-r)}}))}))}computeBaseLayout(){const t=this.style.verticalPadding,e=(this.currentHeight-this.style.verticalPadding-t)/(4*(this.endYear-this.startYear)),i={},o={};for(let n=this.startYear,s=t;n<=this.endYear;n+=.25,s+=e)i[n]=Math.floor(s),o[n]=Array(this.events.length).fill(0);this.yearsYCoords=i,this.occupiedGrid=o,this.centerXCoord=Math.round((this.currentWidth-this.yearXOffset)/2)}computeEventLayout(){const t=[this.centerXCoord];let e=1;for(;t.length<this.events.length;){const i=e*(this.style.eventWidth+this.style.eventOffset);t.push(this.centerXCoord+i),t.length<this.events.length&&t.push(this.centerXCoord-i),e++}const i=[];this.events.forEach((e=>{const o=this.occupiedGrid[e.startYear].indexOf(0),n=t[o];e.xCoord=n,i.push(n);let{endYear:s}=e;"present"===s&&(s=this.endYear);for(let t=e.startYear;t<s;t+=.25)this.occupiedGrid[t][o]=1})),this.infoLeftXCoord=Math.min(...i)-this.style.infoXOffset,this.infoRightXCoord=Math.max(...i)+this.style.infoXOffset}drawBase(){const t=this.canvas.context;t.beginPath(),t.fillStyle=this.style.yearColor,t.textAlign="right",t.font=`${this.style.yearFontSize}px sans-serif`,t.strokeStyle=this.style.gridlineColor,t.lineWidth=this.style.gridlineWidth,Object.entries(this.yearsYCoords).forEach((([e,i])=>{Number.isInteger(Number(e))&&(t.fillText(e,this.currentWidth,Math.round(i+this.style.yearFontSize/2)),t.moveTo(0,i),t.lineTo(this.currentWidth-this.yearXOffset,i))})),t.stroke()}drawEvents(){const t=[];this.canvas.context.font=`${this.style.infoFontSize}px sans-serif`,this.events.forEach((e=>{const i=e.computeInfoLayout();t.push(i),e.infoLayout=i})),this.adjustEventInfo(t),this.events.forEach(((e,i)=>{e.drawInfo(t[i]),e.drawEventLine()}))}getStyles(){const t=getComputedStyle(this.timelineElement),e=t.getPropertyValue("--background-color").trim(),i=parseFloat(t.getPropertyValue("--background-alpha")),n=t.getPropertyValue("--year-color").trim(),s=parseFloat(t.getPropertyValue("--year-alpha")),r=t.getPropertyValue("--gridline-color").trim(),a=parseFloat(t.getPropertyValue("--gridline-alpha")),h=t.getPropertyValue("--info-font-color").trim(),l=parseInt(t.getPropertyValue("--info-font-alpha"),10),d=parseInt(t.getPropertyValue("--info-font-size"),10);this.style={verticalPadding:parseInt(t.getPropertyValue("--vertical-padding"),10),yearFontSize:parseInt(t.getPropertyValue("--year-font-size"),10),gridlineWidth:parseInt(t.getPropertyValue("--gridline-width"),10),eventWidth:parseInt(t.getPropertyValue("--event-width"),10),eventOffset:parseInt(t.getPropertyValue("--event-offset"),10),infoLineWidth:parseInt(t.getPropertyValue("--info-line-width"),10),infoLineAlpha:parseFloat(t.getPropertyValue("--info-line-alpha")),infoXOffset:parseInt(t.getPropertyValue("--info-x-offset"),10),infoYOffset:parseFloat(t.getPropertyValue("--info-y-offset")),infoMinPaddingY:parseInt(t.getPropertyValue("--info-min-padding-y"),10),infoFontSize:d,infoLineHeight:Math.round(d*parseFloat(t.getPropertyValue("--info-line-height"))),infoBackgroundPadding:parseInt(t.getPropertyValue("--info-background-padding"),10),infoBackgroundRadius:parseInt(t.getPropertyValue("--info-background-radius"),10),infoBackgroundAlpha:parseFloat(t.getPropertyValue("--info-background-alpha")),backgroundColor:o(e,i),yearColor:o(n,s),gridlineColor:o(r,a),infoFontColor:o(h,l)}}initCanvas(){const t=document.createElement("canvas"),e=t.getContext("2d");this.currentWidth=this.timelineElement.clientWidth,this.currentHeight=this.timelineElement.clientHeight,t.className="timeline-canvas-el",t.width=this.currentWidth*devicePixelRatio,t.height=this.currentHeight*devicePixelRatio,e.scale(devicePixelRatio,devicePixelRatio),t.style.width=`${this.currentWidth}px`,t.style.height=`${this.currentHeight}px`,this.timelineElement.appendChild(t),this.canvas={element:t,context:e}}onResize(){const t=this.timelineElement.clientWidth,e=this.timelineElement.clientHeight;t===this.currentWidth&&e===this.currentHeight||(this.canvas.context.clearRect(0,0,this.currentWidth,this.currentHeight),this.canvas.element.width=t*devicePixelRatio,this.canvas.element.height=e*devicePixelRatio,this.canvas.context.scale(devicePixelRatio,devicePixelRatio),this.canvas.element.style.width=`${t}px`,this.canvas.element.style.height=`${e}px`,this.currentWidth=t,this.currentHeight=e,this.computeBaseLayout(),this.computeEventLayout(),this.drawBase(),this.drawEvents())}parseEvents(){const e=this.timelineElement.getElementsByTagName("li"),i=[];Array.prototype.forEach.call(e,(e=>{i.push(new t(e,this))})),this.events=i}precomputeStaticValues(){const t=this.canvas.context;t.font=`${this.style.yearFontSize}px sans-serif`,t.textBaseline="bottom",this.yearXOffset=Math.round(t.measureText("00000").width)}setupHoverInteractions(){document.querySelectorAll(".bio-paragraph").forEach((t=>{const e=t.className.match(/bio-group-(\w+)/);if(e){const i=e[1];t.addEventListener("mouseenter",(()=>this.dimGroup(i))),t.addEventListener("mouseleave",(()=>this.clearDimming()))}})),this.canvas.element.addEventListener("mousemove",(t=>this.handleTimelineHover(t))),this.canvas.element.addEventListener("mouseleave",(()=>this.clearDimming()))}handleTimelineHover(t){const e=this.canvas.element.getBoundingClientRect(),i=t.clientX-e.left,o=t.clientY-e.top,n=this.getEventAtPosition(i,o);n?this.isHovering&&this.currentHoveredGroup===n.group||this.dimGroup(n.group):this.isHovering&&this.clearDimming()}getEventAtPosition(t,e){return this.events.find((i=>this.isPositionOverEvent(t,e,i)))||null}isPositionOverEvent(t,e,i){const{yearsYCoords:o,style:n}=this,s=o[i.startYear],r="present"===i.endYear?this.currentHeight:o[i.endYear];if(Math.abs(t-i.xCoord)<=n.eventWidth/2+4&&e>=s-4&&e<=r+4)return!0;if(i.infoLayout){const{infoLayout:o}=i;let n=o.lineXDest;i.xCoord<this.centerXCoord&&(n-=o.width);const s=o.bottomY-o.height,r=n+o.width,a=o.bottomY;if(t>=n-4&&t<=r+4&&e>=s-4&&e<=a+4)return!0}return!1}dimGroup(t){this.currentHoveredGroup=t,this.isHovering=!0;document.querySelectorAll(".bio-paragraph, .bio-img, .bio-text").forEach((e=>{e.classList.contains(`bio-group-${t}`)||e.classList.contains(`bio-img-group-${t}`)||e.classList.contains(`bio-text-group-${t}`)?e.classList.remove("dimmed"):e.classList.add("dimmed")})),this.redrawWithDimming()}clearDimming(){this.currentHoveredGroup=null,this.isHovering=!1;document.querySelectorAll(".bio-paragraph, .bio-img, .bio-text").forEach((t=>{t.classList.remove("dimmed")})),this.redrawWithDimming()}redrawWithDimming(){this.canvas.context.clearRect(0,0,this.currentWidth,this.currentHeight),this.drawBase(),this.drawEventsWithDimming()}drawEventsWithDimming(){const t=[];this.canvas.context.font=`${this.style.infoFontSize}px sans-serif`,this.events.forEach((e=>{const i=e.computeInfoLayout();t.push(i),e.infoLayout=i})),this.adjustEventInfo(t),this.events.forEach(((e,i)=>{const o=this.isHovering&&e.group!==this.currentHoveredGroup;o&&(this.canvas.context.globalAlpha=.3),e.drawInfo(t[i]),e.drawEventLine(),o&&(this.canvas.context.globalAlpha=1)}))}}const i=new Map;function o(t,e=1){const o=`${t}-${e}`;if(i.has(o))return i.get(o);const n=t.trim(),s=n.match(/^#([0-9a-f]+)$/i);if(s){let n=s[1];if(3===n.length)n=n.split("").map((t=>t+t)).join("");else if(6!==n.length)throw new Error(`colorToRGBA: Failed to parse color: ${t}`);const r=`rgba(${parseInt(n.slice(0,2),16)},${parseInt(n.slice(2,4),16)},${parseInt(n.slice(4,6),16)},${e})`;return i.set(o,r),r}const r=n.match(/^rgb\(\s*([^)]+)\s*\)$/i);if(r){const t=`rgba(${r[1]},${e})`;return i.set(o,t),t}const a=n.match(/^rgba\(((?:\s*[^,]+,){3})(?:[^,)]+)\)$/i);if(a){const t=`rgba(${a[1]},${e})`;return i.set(o,t),t}try{const t=document.createElement("div");t.style.color=n,document.body.appendChild(t);const s=getComputedStyle(t).color;document.body.removeChild(t);const r=s.match(/rgba?\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)(?:\s*,\s*[^)]+)?\s*\)$/i);if(!r)throw new Error;const[,a,h,l]=r,d=`rgba(${a},${h},${l},${e})`;return i.set(o,d),d}catch{throw new Error(`colorToRGBA: Failed to parse color: ${t}`)}}function n(t,e,i,o,n,s){t.beginPath(),t.moveTo(e,i+s),t.lineTo(e,i+n-s),t.quadraticCurveTo(e,i+n,e+s,i+n),t.lineTo(e+o-s,i+n),t.quadraticCurveTo(e+o,i+n,e+o,i+n-s),t.lineTo(e+o,i+s),t.quadraticCurveTo(e+o,i,e+o-s,i),t.lineTo(e+s,i),t.quadraticCurveTo(e,i,e,i+s),t.closePath(),t.fill()}const s=document.getElementById("timeline");null!==s&&window.addEventListener("load",(()=>{const t=new e(s);window.addEventListener("resize",(()=>t.onResize()))}))})();
//# sourceMappingURL=timeline.min.js.map