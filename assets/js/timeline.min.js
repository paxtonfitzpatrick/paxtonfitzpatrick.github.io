(()=>{"use strict";class t{constructor(t,e){this.timeline=e,this.info=t.innerText.trim(),this.startYear=parseFloat(t.dataset.start),this.endYear=parseFloat(t.dataset.end),this.color=`#${t.dataset.color}`,this.xCoord=null}drawEventLine(){const t=this.timeline.canvas.context,e=this.timeline.style.eventWidth,i=this.timeline.yearsYCoords;t.beginPath(),t.lineWidth=e,t.strokeStyle=this.color,t.lineCap="round",t.moveTo(this.xCoord,i[this.startYear]+e/2),t.lineTo(this.xCoord,i[this.endYear]-e/2),t.stroke()}drawInfo(t){const e=this.timeline.canvas.context;e.beginPath(),e.strokeStyle=this.color,e.lineWidth=this.timeline.style.infoLineWidth,e.fillStyle=this.timeline.style.info_font_color,e.textBaseline="bottom",e.textAlign=t.alignment,t.lineArr.forEach(((i,s,n)=>{console.log(i,t.xCoord,this.timeline.yearsYCoords[this.startYear]-t.lineHeight*(n.length-1-s)),e.fillText(i,t.xCoord,this.timeline.yearsYCoords[this.startYear]-t.lineHeight*(n.length-1-s))}));let i=this.timeline.yearsYCoords[this.startYear+this.timeline.style.infoYOffset];this.endYear-this.startYear<=this.timeline.style.infoYOffset&&(i=Math.floor((this.timeline.yearsYCoords[this.startYear]+this.timeline.yearsYCoords[this.endYear])/2)),e.moveTo(this.xCoord,i),e.lineTo(t.xCoord,this.timeline.yearsYCoords[this.startYear]+t.lineHeight),e.lineTo(t.underlineX,this.timeline.yearsYCoords[this.startYear]+t.lineHeight),e.stroke()}formatInfoLayout(){const t={lineArr:[],lineHeight:this.timeline.style.infoLineHeight},e=this.info.split(" ");let i,s=e[0];return this.xCoord>=this.timeline.centerXCoord?(t.xCoord=this.timeline.infoRightXCoord,t.alignment="left",i=this.timeline.currentWidth-t.xCoord):(t.xCoord=this.timeline.infoLeftXCoord,t.alignment="right",i=t.xCoord),e.slice(1).forEach((e=>{const n=`${s} ${e}`;this.timeline.canvas.context.measureText(n).width>i||s.endsWith(",")?(t.lineArr.push(s),s=e):s=n})),t.lineArr.push(s),t.width=Math.max(...t.lineArr.map((t=>this.timeline.canvas.context.measureText(t).width))),"left"===t.alignment?t.underlineX=t.xCoord+t.width:t.underlineX=t.xCoord-t.width,t}}class e{constructor(t){this.timelineElement=t,this.currentWidth=t.clientWidth,this.currentHeight=t.clientHeight,this.startYear=parseInt(t.dataset.start,10),this.endYear=parseInt(t.dataset.end,10),this.initCanvas(t),this.getStyles(),this.parseEvents(),this.precomputeStaticValues(),this.computeBaseLayout(),this.computeEventLayout(),this.drawBase(),this.drawEvents()}precomputeStaticValues(){const t=this.canvas.context;t.font=`${this.style.yearFontsize}px sans-serif`,t.textBaseline="bottom";const e=t.measureText("00000");this.yearXOffset=e.width}computeBaseLayout(){const t=this.style.verticalPadding,e=(this.canvas.element.height-this.style.verticalPadding-t)/(4*(this.endYear-this.startYear)),i={},s={};for(let n=this.startYear,r=t;n<=this.endYear;n+=.25,r+=e)i[n]=Math.floor(r),s[n]=Array(this.events.length).fill(0);this.yearsYCoords=i,this.occupedGrid=s,this.centerXCoord=Math.round(this.canvas.element.width/2-this.yearXOffset)}computeEventLayout(){const t=[this.centerXCoord];let e=1;for(;t.length<this.events.length;){const i=e*(this.style.eventWidth+this.style.eventOffset);t.push(this.centerXCoord+i),t.length<this.events.length&&t.push(this.centerXCoord-i),e++}const i=[];this.events.forEach((e=>{const s=this.occupedGrid[e.startYear].indexOf(0),n=t[s];e.xCoord=n,i.push(n);for(let t=e.startYear;t<e.endYear;t+=.25)this.occupedGrid[t][s]=1})),this.infoLeftXCoord=Math.min(...i)-this.style.infoXOffset,this.infoRightXCoord=Math.max(...i)+this.style.infoXOffset}drawBase(){const t=this.canvas.context;t.beginPath(),t.fillStyle=this.style.yearColor,t.textAlign="right",t.font=`${this.style.yearFontsize}px sans-serif`,t.strokeStyle=this.style.gridlineColor,t.lineWidth=this.style.gridlineWidth;for(const[e,i]of Object.entries(this.yearsYCoords))Number.isInteger(Number(e))&&(t.fillText(e,this.canvas.element.width,i+this.style.yearFontsize/2),t.moveTo(0,i),t.lineTo(this.canvas.element.width-this.yearXOffset,i));t.stroke()}drawEvents(){this.canvas.context.font=`${this.style.infoFontSize}px sans-serif`,this.events.forEach((t=>{t.drawEventLine();const e=t.formatInfoLayout();t.drawInfo(e)}))}getStyles(){const t=getComputedStyle(this.timelineElement),e=t.getPropertyValue("--background-color").trim(),s=parseFloat(t.getPropertyValue("--background-alpha")),n=t.getPropertyValue("--year-color").trim(),r=parseFloat(t.getPropertyValue("--year-alpha")),o=t.getPropertyValue("--gridline-color").trim(),a=parseFloat(t.getPropertyValue("--gridline-alpha")),h=t.getPropertyValue("--info-font-color").trim(),l=parseInt(t.getPropertyValue("--info-font-alpha"),10),d=parseInt(t.getPropertyValue("--info-font-size"),10);this.style={verticalPadding:parseInt(t.getPropertyValue("--vertical-padding"),10),yearFontsize:parseInt(t.getPropertyValue("--year-font-size"),10),gridlineWidth:parseInt(t.getPropertyValue("--gridline-width"),10),eventWidth:parseInt(t.getPropertyValue("--event-width"),10),eventOffset:parseInt(t.getPropertyValue("--event-offset"),10),infoLineWidth:parseInt(t.getPropertyValue("--info-line-width"),10),infoXOffset:parseInt(t.getPropertyValue("--info-x-offset"),10),infoYOffset:parseFloat(t.getPropertyValue("--info-y-offset")),infoFontSize:d,infoLineHeight:d*parseFloat(t.getPropertyValue("--info-line-height")),backgroundColor:i(e,s),yearColor:i(n,r),gridlineColor:i(o,a),infoFontColor:i(h,l)}}initCanvas(t){const e=document.createElement("canvas");e.className="timeline-canvas-el",e.width=t.clientWidth,e.height=t.clientHeight,t.appendChild(e),this.canvas={element:e,context:e.getContext("2d")}}onResize(){const t=this.timelineElement.clientWidth,e=this.timelineElement.clientHeight;t===this.currentWidth&&e===this.currentHeight||(this.canvas.context.clearRect(0,0,this.currentWidth,this.currentHeight),this.canvas.element.width=t,this.canvas.element.height=e,this.currentWidth=t,this.currentHeight=e,this.computeBaseLayout(),this.computeEventLayout(),this.drawBase(),this.drawEvents())}parseEvents(){const e=this.timelineElement.getElementsByTagName("li"),i=[];Array.prototype.forEach.call(e,(e=>{i.push(new t(e,this))})),this.events=i}}const i=(t,e=1)=>{const i=t.replace("#","");return`rgba(${parseInt(i.substring(0,2),16)},${parseInt(i.substring(2,4),16)},${parseInt(i.substring(4,6),16)},${e})`},s=document.getElementById("timeline");null!==s&&window.addEventListener("load",(()=>{const t=new e(s);window.timeline=t,window.addEventListener("resize",(()=>t.onResize()))}))})();