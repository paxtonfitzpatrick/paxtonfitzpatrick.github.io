"use strict";(()=>{class e{constructor(e,t){this.timeline=t,this.startYear=parseFloat(e.dataset.start);const i=e.dataset.end;this.endYear="present"===i?i:parseFloat(i),this.group=e.dataset.group,this.color=getComputedStyle(this.timeline.timelineElement).getPropertyValue(`--group-${this.group}`).trim(),this.backgroundColor=n(this.color,t.style.infoBackgroundAlpha),this.info=e.innerText.trim(),this.xCoord=null}computeInfoLayout(){const{canvas:{context:e},style:t,yearsYCoords:i}=this.timeline,n={lineArr:[],bottomY:i[this.startYear]},s=this.info.split(" "),o=[];let r,a=s[0],h=e.measureText(s[0]).width;return this.xCoord>=this.timeline.centerXCoord?(n.lineXDest=this.timeline.infoRightXCoord,r=this.timeline.currentWidth-n.lineXDest-this.timeline.yearXOffset):(n.lineXDest=this.timeline.infoLeftXCoord,r=n.lineXDest),r-=2*t.infoBackgroundPadding,s.slice(1).forEach((t=>{const i=`${a} ${t}`,s=e.measureText(i).width;s>r||a.endsWith(",")?(n.lineArr.push(a),o.push(h),a=t,h=s-h):(a=i,h=s)})),n.lineArr.push(a),o.push(h),n.width=Math.max(...o)+2*t.infoBackgroundPadding,n.height=t.infoLineHeight*n.lineArr.length+2*t.infoBackgroundPadding,n}drawEventLine(){const{canvas:{context:e},style:{eventWidth:t},yearsYCoords:i}=this.timeline;if(e.beginPath(),e.lineWidth=t,e.lineCap="round",e.moveTo(this.xCoord,i[this.startYear]+t/2),"present"===this.endYear){const t=e.createLinearGradient(this.xCoord,i[this.startYear],this.xCoord,this.timeline.currentHeight);t.addColorStop(.25,this.color),t.addColorStop(1,this.timeline.style.backgroundColor),e.strokeStyle=t,e.lineTo(this.xCoord,this.timeline.currentHeight)}else e.strokeStyle=this.color,e.lineTo(this.xCoord,i[this.endYear]-t/2);e.stroke()}drawInfo(e){const{canvas:{context:t},style:i,yearsYCoords:o,centerXCoord:r}=this.timeline;let{lineXDest:a,bottomY:h}=e,l=a,c=o[this.startYear+i.infoYOffset];this.xCoord>=r?a+=i.infoBackgroundRadius/2:(a-=i.infoBackgroundRadius/2,l-=e.width),"present"!==this.endYear&&this.endYear-this.startYear<=i.infoYOffset&&(c=Math.round((this.timeline.yearsYCoords[this.startYear]+this.timeline.yearsYCoords[this.endYear])/2)),e.bottomY<c?h-=i.infoBackgroundRadius/2:e.bottomY-e.height>c?h-=e.height-i.infoBackgroundRadius/2:h-=e.height/2,t.strokeStyle=n(this.color,i.infoLineAlpha),t.lineWidth=i.infoLineWidth,t.beginPath(),t.moveTo(this.xCoord,c),t.lineTo(Math.round(a),Math.round(h)),t.stroke(),t.fillStyle=i.backgroundColor,s(t,l,e.bottomY-e.height,e.width,e.height,i.infoBackgroundRadius),t.fillStyle=this.backgroundColor,s(t,l,e.bottomY-e.height,e.width,e.height,i.infoBackgroundRadius),t.beginPath(),t.font=`${i.infoFontSize}px sans-serif`,t.fillStyle=i.infoFontColor,t.textBaseline="bottom",t.textAlign="left",t.lineJoin="round",e.lineArr.forEach(((n,s,o)=>{t.fillText(n,l+i.infoBackgroundPadding,e.bottomY-i.infoBackgroundPadding-i.infoLineHeight*(o.length-1-s)),n.endsWith(",")&&(t.font=`italic ${i.infoFontSize}px sans-serif`)}))}}class t{constructor(e){this.timelineElement=e,this.startYear=parseInt(e.dataset.start,10),this.endYear=parseInt(e.dataset.end,10),this.currentHoveredGroup=null,this.isHovering=!1,this.hoverInteractionsEnabled=!1,this.hoverDebounceTimer=null,this.transitionStartTime=null,this.isTransitioning=!1,this.eventOpacities=new Map,this.targetOpacities=new Map,this.initCanvas(),this.getStyles(),this.parseEvents(),this.precomputeStaticValues(),this.computeBaseLayout(),this.computeEventLayout(),this.drawBase(),this.drawEvents(),this.initializeOpacitySystem(),this.setupHoverInteractions()}initializeOpacitySystem(){this.events.forEach((e=>{this.eventOpacities.set(e,1),this.targetOpacities.set(e,1)}))}adjustEventInfo(e){[this.infoLeftXCoord,this.infoRightXCoord].forEach((t=>{const i=e.filter((e=>e.lineXDest===t));i.slice(1).forEach(((e,t)=>{const n=e.bottomY-e.height,s=i[t];if(n<s.bottomY+this.style.infoMinPaddingY){const o=s.bottomY+this.style.infoMinPaddingY-n;let r=s.bottomY-s.height;t>0&&(r-=i[t-1].bottomY+this.style.infoMinPaddingY),r>=o?s.bottomY-=o:(s.bottomY-=r,e.bottomY+=o-r)}}))}))}computeBaseLayout(){const e=this.style.verticalPadding,t=(this.currentHeight-this.style.verticalPadding-e)/(4*(this.endYear-this.startYear)),i={},n={};for(let s=this.startYear,o=e;s<=this.endYear;s+=.25,o+=t)i[s]=Math.floor(o),n[s]=Array(this.events.length).fill(0);this.yearsYCoords=i,this.occupiedGrid=n,this.centerXCoord=Math.round((this.currentWidth-this.yearXOffset)/2)}computeEventLayout(){const e=[this.centerXCoord];let t=1;for(;e.length<this.events.length;){const i=t*(this.style.eventWidth+this.style.eventOffset);e.push(this.centerXCoord+i),e.length<this.events.length&&e.push(this.centerXCoord-i),t++}const i=[];this.events.forEach((t=>{const n=this.occupiedGrid[t.startYear].indexOf(0),s=e[n];t.xCoord=s,i.push(s);let{endYear:o}=t;"present"===o&&(o=this.endYear);for(let e=t.startYear;e<o;e+=.25)this.occupiedGrid[e][n]=1})),this.infoLeftXCoord=Math.min(...i)-this.style.infoXOffset,this.infoRightXCoord=Math.max(...i)+this.style.infoXOffset}drawBase(){const e=this.canvas.context;e.beginPath(),e.fillStyle=this.style.yearColor,e.textAlign="right",e.font=`${this.style.yearFontSize}px sans-serif`,e.strokeStyle=this.style.gridlineColor,e.lineWidth=this.style.gridlineWidth,Object.entries(this.yearsYCoords).forEach((([t,i])=>{Number.isInteger(Number(t))&&(e.fillText(t,this.currentWidth,Math.round(i+this.style.yearFontSize/2)),e.moveTo(0,i),e.lineTo(this.currentWidth-this.yearXOffset,i))})),e.stroke()}drawEvents(){const e=[];this.canvas.context.font=`${this.style.infoFontSize}px sans-serif`,this.events.forEach((t=>{const i=t.computeInfoLayout();e.push(i),t.infoLayout=i})),this.adjustEventInfo(e),this.events.forEach(((t,i)=>{t.drawInfo(e[i]),t.drawEventLine()}))}getStyles(){const e=getComputedStyle(this.timelineElement),t=e.getPropertyValue("--background-color").trim(),i=parseFloat(e.getPropertyValue("--background-alpha")),s=e.getPropertyValue("--year-color").trim(),o=parseFloat(e.getPropertyValue("--year-alpha")),r=e.getPropertyValue("--gridline-color").trim(),a=parseFloat(e.getPropertyValue("--gridline-alpha")),h=e.getPropertyValue("--info-font-color").trim(),l=parseInt(e.getPropertyValue("--info-font-alpha"),10),c=parseInt(e.getPropertyValue("--info-font-size"),10);this.style={verticalPadding:parseInt(e.getPropertyValue("--vertical-padding"),10),yearFontSize:parseInt(e.getPropertyValue("--year-font-size"),10),gridlineWidth:parseInt(e.getPropertyValue("--gridline-width"),10),eventWidth:parseInt(e.getPropertyValue("--event-width"),10),eventOffset:parseInt(e.getPropertyValue("--event-offset"),10),eventHoverMargin:parseInt(e.getPropertyValue("--event-hover-margin"),10),infoLineWidth:parseInt(e.getPropertyValue("--info-line-width"),10),infoLineAlpha:parseFloat(e.getPropertyValue("--info-line-alpha")),infoXOffset:parseInt(e.getPropertyValue("--info-x-offset"),10),infoYOffset:parseFloat(e.getPropertyValue("--info-y-offset")),infoMinPaddingY:parseInt(e.getPropertyValue("--info-min-padding-y"),10),infoFontSize:c,infoLineHeight:Math.round(c*parseFloat(e.getPropertyValue("--info-line-height"))),infoBackgroundPadding:parseInt(e.getPropertyValue("--info-background-padding"),10),infoBackgroundRadius:parseInt(e.getPropertyValue("--info-background-radius"),10),infoBackgroundAlpha:parseFloat(e.getPropertyValue("--info-background-alpha")),backgroundColor:n(t,i),yearColor:n(s,o),gridlineColor:n(r,a),infoFontColor:n(h,l),eventHoverOpacity:parseFloat(e.getPropertyValue("--event-dimmed-opacity")),transitionDuration:parseFloat(e.getPropertyValue("--transition-duration")),hoverDebounceDelay:parseFloat(e.getPropertyValue("--hover-debounce-delay"))}}initCanvas(){const e=document.createElement("canvas"),t=e.getContext("2d");this.currentWidth=this.timelineElement.clientWidth,this.currentHeight=this.timelineElement.clientHeight,e.className="timeline-canvas-el",e.width=this.currentWidth*devicePixelRatio,e.height=this.currentHeight*devicePixelRatio,t.scale(devicePixelRatio,devicePixelRatio),e.style.width=`${this.currentWidth}px`,e.style.height=`${this.currentHeight}px`,this.timelineElement.appendChild(e),this.canvas={element:e,context:t}}onResize(){const e=this.timelineElement.clientWidth,t=this.timelineElement.clientHeight;e===this.currentWidth&&t===this.currentHeight||(this.canvas.context.clearRect(0,0,this.currentWidth,this.currentHeight),this.canvas.element.width=e*devicePixelRatio,this.canvas.element.height=t*devicePixelRatio,this.canvas.context.scale(devicePixelRatio,devicePixelRatio),this.canvas.element.style.width=`${e}px`,this.canvas.element.style.height=`${t}px`,this.currentWidth=e,this.currentHeight=t,this.computeBaseLayout(),this.computeEventLayout(),this.drawBase(),this.drawEvents(),this.initializeOpacitySystem(),this.setupHoverInteractions())}parseEvents(){const t=this.timelineElement.getElementsByTagName("li"),i=[];Array.prototype.forEach.call(t,(t=>{i.push(new e(t,this))})),this.events=i}precomputeStaticValues(){const e=this.canvas.context;e.font=`${this.style.yearFontSize}px sans-serif`,e.textBaseline="bottom",this.yearXOffset=Math.round(e.measureText("00000").width)}shouldEnableHoverInteractions(){return window.innerWidth>=992&&window.matchMedia("(hover: hover)").matches}removeHoverInteractions(){this.hoverDebounceTimer&&(clearTimeout(this.hoverDebounceTimer),this.hoverDebounceTimer=null),this.hoverEventListeners&&(this.hoverEventListeners.forEach(((e,t)=>{t.removeEventListener("mouseenter",e.mouseenter),t.removeEventListener("mouseleave",e.mouseleave)})),this.hoverEventListeners.clear()),this.canvasMousemoveHandler&&(this.canvas.element.removeEventListener("mousemove",this.canvasMousemoveHandler),this.canvasMousemoveHandler=null),this.canvasMouseleaveHandler&&(this.canvas.element.removeEventListener("mouseleave",this.canvasMouseleaveHandler),this.canvasMouseleaveHandler=null),this.hoverInteractionsEnabled=!1,this.clearDimming()}setupHoverInteractions(){if(this.removeHoverInteractions(),!this.shouldEnableHoverInteractions())return;const e=document.querySelectorAll(".bio-text"),t=document.querySelectorAll(".bio-img");this.hoverEventListeners=new Map,e.forEach((e=>{const t=e.className.match(/bio-text-group-([\w-]+)/);if(t){const i=t[1],n=()=>this.handleBioHoverEnter(i),s=()=>this.handleBioHoverLeave();e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",s),this.hoverEventListeners.set(e,{mouseenter:n,mouseleave:s})}})),t.forEach((e=>{const t=e.className.match(/bio-img-group-([\w-]+)/);if(t){const i=t[1],n=()=>this.handleBioHoverEnter(i),s=()=>this.handleBioHoverLeave();e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",s),this.hoverEventListeners.set(e,{mouseenter:n,mouseleave:s})}})),this.canvasMousemoveHandler=e=>this.handleTimelineHover(e),this.canvasMouseleaveHandler=()=>this.handleBioHoverLeave(),this.canvas.element.addEventListener("mousemove",this.canvasMousemoveHandler),this.canvas.element.addEventListener("mouseleave",this.canvasMouseleaveHandler),this.hoverInteractionsEnabled=!0}handleBioHoverEnter(e){this.hoverDebounceTimer&&(clearTimeout(this.hoverDebounceTimer),this.hoverDebounceTimer=null),this.dimGroup(e)}handleBioHoverLeave(){this.hoverDebounceTimer=setTimeout((()=>{this.clearDimming(),this.hoverDebounceTimer=null}),this.style.hoverDebounceDelay)}handleTimelineHover(e){const t=this.canvas.element.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top,s=this.getEventAtPosition(i,n);s?(this.hoverDebounceTimer&&(clearTimeout(this.hoverDebounceTimer),this.hoverDebounceTimer=null),this.isHovering&&this.currentHoveredGroup===s.group||this.dimGroup(s.group)):this.isHovering&&this.handleBioHoverLeave()}getEventAtPosition(e,t){return this.events.find((i=>this.isPositionOverEvent(e,t,i)))||null}isPositionOverEvent(e,t,i){const{yearsYCoords:n,style:s}=this,o=n[i.startYear],r="present"===i.endYear?this.currentHeight:n[i.endYear];if(Math.abs(e-i.xCoord)<=s.eventWidth/2+s.eventHoverMargin&&t>=o-s.eventHoverMargin&&t<=r+s.eventHoverMargin)return!0;if(i.infoLayout){const{infoLayout:n}=i;let o=n.lineXDest;i.xCoord<this.centerXCoord&&(o-=n.width);const r=n.bottomY-n.height,a=o+n.width,h=n.bottomY;if(e>=o-s.eventHoverMargin&&e<=a+s.eventHoverMargin&&t>=r-s.eventHoverMargin&&t<=h+s.eventHoverMargin)return!0}return!1}dimGroup(e){if(!this.hoverInteractionsEnabled)return;this.currentHoveredGroup=e,this.isHovering=!0;document.querySelectorAll(".bio-img, .bio-text").forEach((t=>{t.classList.contains(`bio-img-group-${e}`)||t.classList.contains(`bio-text-group-${e}`)?t.classList.remove("dimmed"):t.classList.add("dimmed")})),this.events.forEach((t=>{const i=t.group===e?1:this.style.eventHoverOpacity;this.targetOpacities.set(t,i)})),this.startTransition()}clearDimming(){this.currentHoveredGroup=null,this.isHovering=!1;document.querySelectorAll(".bio-img, .bio-text").forEach((e=>{e.classList.remove("dimmed")})),this.events.forEach((e=>{this.targetOpacities.set(e,1)})),this.startTransition()}startTransition(){this.initialOpacities||(this.initialOpacities=new Map),this.events.forEach((e=>{const t=this.eventOpacities.get(e)||1;this.initialOpacities.set(e,t)})),this.transitionStartTime=performance.now(),this.isTransitioning=!0,this.animateTransition()}animateTransition(){if(!this.isTransitioning)return;const e=performance.now()-this.transitionStartTime,t=Math.min(e/this.style.transitionDuration,1);this.events.forEach((e=>{const i=this.initialOpacities.get(e)||1,n=i+((this.targetOpacities.get(e)||1)-i)*t;this.eventOpacities.set(e,n)})),this.redrawWithTransitions(),t<1?requestAnimationFrame((()=>this.animateTransition())):this.isTransitioning=!1}redrawWithTransitions(){this.canvas.context.clearRect(0,0,this.currentWidth,this.currentHeight),this.drawBase(),this.drawEventsWithTransitions()}drawEventsWithTransitions(){const e=[];this.canvas.context.font=`${this.style.infoFontSize}px sans-serif`,this.events.forEach((t=>{const i=t.computeInfoLayout();e.push(i),t.infoLayout=i})),this.adjustEventInfo(e),this.events.forEach(((t,i)=>{const n=this.eventOpacities.get(t)||1;n<1&&(this.canvas.context.globalAlpha=n),t.drawInfo(e[i]),t.drawEventLine(),n<1&&(this.canvas.context.globalAlpha=1)}))}}const i=new Map;function n(e,t=1){const n=`${e}-${t}`;if(i.has(n))return i.get(n);const s=e.trim(),o=s.match(/^#([0-9a-f]+)$/i);if(o){let s=o[1];if(3===s.length)s=s.split("").map((e=>e+e)).join("");else if(6!==s.length)throw new Error(`colorToRGBA: Failed to parse color: ${e}`);const r=`rgba(${parseInt(s.slice(0,2),16)},${parseInt(s.slice(2,4),16)},${parseInt(s.slice(4,6),16)},${t})`;return i.set(n,r),r}const r=s.match(/^rgb\(\s*([^)]+)\s*\)$/i);if(r){const e=`rgba(${r[1]},${t})`;return i.set(n,e),e}const a=s.match(/^rgba\(((?:\s*[^,]+,){3})(?:[^,)]+)\)$/i);if(a){const e=`rgba(${a[1]},${t})`;return i.set(n,e),e}try{const e=document.createElement("div");e.style.color=s,document.body.appendChild(e);const o=getComputedStyle(e).color;document.body.removeChild(e);const r=o.match(/rgba?\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)(?:\s*,\s*[^)]+)?\s*\)$/i);if(!r)throw new Error;const[,a,h,l]=r,c=`rgba(${a},${h},${l},${t})`;return i.set(n,c),c}catch{throw new Error(`colorToRGBA: Failed to parse color: ${e}`)}}function s(e,t,i,n,s,o){e.beginPath(),e.moveTo(t,i+o),e.lineTo(t,i+s-o),e.quadraticCurveTo(t,i+s,t+o,i+s),e.lineTo(t+n-o,i+s),e.quadraticCurveTo(t+n,i+s,t+n,i+s-o),e.lineTo(t+n,i+o),e.quadraticCurveTo(t+n,i,t+n-o,i),e.lineTo(t+o,i),e.quadraticCurveTo(t,i,t,i+o),e.closePath(),e.fill()}const o=document.getElementById("timeline");null!==o&&window.addEventListener("load",(()=>{const e=new t(o);window.addEventListener("resize",(()=>e.onResize()))}))})();
//# sourceMappingURL=timeline.min.js.map